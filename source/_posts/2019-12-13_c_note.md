---
title: C语言笔记
date: 2019-12-13 12:12:14
tags: C
categories: C语言
toc: true
excerpt: 记录C语言相关的笔记
---
# 编译和链接
- 编译器的任务
编译器把**源代码**（如，用C语言编写的代码）翻译成等价的**机器语言代码**（也叫作目标代码）。
- 链接器的任务
链接器把编译器翻译好的**目标代码**、**库代码**和**启动代码**组合起来，生成一个**可执行程序**。
## gcc
### C程序的完整编译过程示例
1. 预处理（Prepressing）
```bash
gcc -E hello.c -o hello.i
```
2. 编译（Compilation）
```bash
gcc -S hello.i -o hello.s
```
3. 汇编（Assembly）
```bash
gcc -c hello.s -o hello.o
```
4. 链接（Linking）
```bash
gcc hello.o -o hello
``` 
### GCC基本语法
```bash
-o [filename]：指定输出文件名称。

-c：仅编译，不进行链接，生成目标文件（.o）。

-E：仅执行预处理，生成预处理文件（.i）。

-S：将源代码编译为汇编代码（.s）。

-g：生成调试信息，便于使用调试工具（如GDB）。

-O：优化代码，支持-O1、-O2、-O3等不同优化级别。

-Wall：启用所有警告信息。

-static：使用静态链接。

-shared：生成共享库。

-I [dir]：指定头文件搜索路径。

-L [dir]：指定库文件搜索路径。

-l [libname]：链接指定的库。
```
# sizeof和strlen
 |      | sizeof       | strlen                                 |
 | ---- | ------------ | -------------------------------------- |
 | 性质 | 编译时运算符 | ‌库函数(string.h)                      |
 | 作用 | 计算字节大小 | 计算字符串的长度（不包括结尾的\0字符） |
# 指针
指针(**pointer**)是一个值为内存地址的变量（或数据对象）。
## 可以对指针进行哪些操作？
1. **赋值**：可以把地址赋给指针。
2. **解引用**：`*`运算符给出指针指向地址上储存的值。
3. **取址**：和所有变量一样，指针变量也有自己的地址和值。对指针而言，`&`运算符给出指针本身的地址。
4. **指针与整数相加**：可以使用`+`运算符把指针与整数相加，或整数与指针相加。无论哪种情况，整数都会和指针所指向类型的大小（以字节为单位）相乘，然后把结果与初始地址相加。
5. **递增指针**：递增指向数组元素的指针可以让该指针移动至数组的下一个元素。
6. **指针减去一个整数**：可以使用`-`运算符从一个指针中减去一个整数。指针必须是第1个运算对象，整数是第2个运算对象。该整数将乘以指针指向类型的大小（以字节为单位），然后用初始地址减去乘积。
7. **递减指针**：递减指向数组元素的指针可以让该指针移动至数组的上一个元素。
8. **指针求差**：可以计算两个指针的差值。通常，求差的两个指针分别指向同一个数组的不同元素，通过计算求出两元素之间的距离。差值的单位与数组类型的单位相同。
9. **比较**：使用关系运算符可以比较两个指针的值，前提是两个指针都指向相同类型的对象。
## 复合字面量
1. **语法形式为**：
```C
(类型名){ 初始化列表 }
/* 例如 */
int* ptr = (int[2]){ 2, 4 };
```
- 类型名 
指定了要创建的匿名对象的类型，如 `int[5]`、`struct point`等。
- 初始化列表 
与普通变量初始化语法相同，用于给该匿名对象赋初值。
2. **作用域与生命周期**‌：
- 当复合字面量出现在函数体外时，它具有‌静态存储期‌（整个程序运行期间存在）。
- 当出现在函数体内时，它具有‌自动存储期‌（通常在其所在的块作用域结束时失效）。
- 其地址可以被获取，并且可以像普通变量一样被修改（除非被限定为`const`）。
3. **‌提高代码紧凑性与可读性**‌：
- 避免了为仅使用一次的临时变量单独命名和声明，使代码更简洁。

## 函数指针&函数指针
|          | 指针函数                       | 函数指针                   |
| -------- | ------------------------------ | -------------------------- |
| 性质     | 函数，返回指针类型             | 指针变量，存储函数地址     |
| 示例     | int* fun(int a)                | int (*fun)(int, int)       |
| 使用场景 | 返回数据地址（如数组、字符串） | 动态调用函数（如回调机制） |
# 存储类别
## 作用域
作用域描述程序中可访问标识符的区域。一个C变量的作用域可以是**块作用域**、**函数作用域**、**函数原型作用域**或**文件作用域**。